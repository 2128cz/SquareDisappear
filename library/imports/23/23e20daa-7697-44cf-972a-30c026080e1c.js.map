{"version":3,"sources":["assets\\scripts\\GameSc.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { Msger } from \"./Msger\";\r\nimport BrickSc from \"./BrickSc\";\r\nimport DelayDelSc from \"./DelayDelSc\";\r\n\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class GameSc extends cc.Component {\r\n\r\n    @property(cc.Label)\r\n    scoreLabel: cc.Label = null;\r\n    @property(cc.Node)\r\n    bricksLayer: cc.Node = null;\r\n    @property(cc.Node)\r\n    closeLayer: cc.Node = null;\r\n    @property(cc.Prefab)\r\n    blockPrefab: cc.Prefab = null;\r\n    @property(dragonBones.ArmatureDisplay)\r\n    xiaochuEffect: dragonBones.ArmatureDisplay = null;\r\n    @property(dragonBones.ArmatureDisplay)\r\n    quanjiEffect: dragonBones.ArmatureDisplay = null;\r\n\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n    private points: number[] = [];\r\n    private begin_y: number = 694;\r\n    onLoad() {\r\n        this.quanjiEffect.node.active = false;\r\n        Msger.on(Msger.on_game_begin, this.on_game_begin, this);\r\n        Msger.on(Msger.on_game_revie, this.on_game_revie, this);\r\n        for (const iterator of this.bricksLayer.children) {\r\n            this.points.push(iterator.x);\r\n        }\r\n        this.bricksLayer.removeAllChildren();\r\n    }\r\n    private on_game_revie() {\r\n        this.isPaused = false;\r\n        this.gametime *= 0.25;\r\n    }\r\n    private on_game_begin() {\r\n        this.score = 0;\r\n        this.gametime = 0;\r\n        this.isPaused = false;\r\n        this.bricksLayer.removeAllChildren();\r\n    }\r\n    gametime = 0;\r\n\r\n    private _score: number;\r\n    public get score(): number {\r\n        return this._score;\r\n    }\r\n    public set score(v: number) {\r\n        this._score = v;\r\n        this.scoreLabel.string = v.toString();\r\n    }\r\n    isPaused = true;\r\n    private movespeed = 150;\r\n    g_movespeed_sc = 1;\r\n    update(dt) {\r\n        if (this.isPaused) {\r\n            return;\r\n        }\r\n        this.gametime += dt;\r\n        if (this.gametime > 60) {\r\n            this.gametime = 60;\r\n        }\r\n        for (let item of this.closeLayer.children) {\r\n            if (item.getComponent(DelayDelSc)) {\r\n                continue;\r\n            }\r\n            this.score += this.closeOne(item);\r\n        }\r\n        let topBrick = null;\r\n        for (let item of this.bricksLayer.children) {\r\n            let sc = item.getComponent(BrickSc);\r\n            let movespdsc = this.g_movespeed_sc;\r\n            ///对于不是打上去的砖块则特殊处理一下\r\n            if (sc.moveSpeed != 0) {\r\n                movespdsc = 1;\r\n            }\r\n            item.y -= dt * (this.movespeed + sc.moveSpeed) * movespdsc * (this.gametime / 60 + 1);\r\n            if (sc.moveSpeed != 0) {\r\n                this.check_collision(item);\r\n            } else {\r\n                // \r\n                if (topBrick == null) {\r\n                    topBrick = item;\r\n                } else if (item.y > topBrick.y) {\r\n                    topBrick = item;\r\n                }\r\n            }\r\n        }\r\n        if (this.bricksLayer.childrenCount <= 0) {\r\n            this.add_line_bricks();\r\n        } else if (topBrick) {\r\n            if (topBrick.y < this.begin_y) {\r\n                this.add_line_bricks(topBrick);\r\n            }\r\n        }\r\n        this.check_line_close();\r\n    }\r\n    private check_line_close() {\r\n        let array = [];\r\n        for (let item of this.bricksLayer.children) {\r\n            let key = Math.floor(item.y / item.height);\r\n            if (array[key]) {\r\n                array[key].push(item);\r\n            } else {\r\n                array[key] = [item];\r\n            }\r\n        }\r\n        for (let key in array) {\r\n            if (array[key].length === 4) {\r\n                let y = array[key][2].y;\r\n                for (let item of array[key]) {\r\n                    (item as cc.Node).parent = this.closeLayer;\r\n                    (item as cc.Node).y = y;\r\n                }\r\n                //显示特效\r\n                this.xiaochuEffect.playAnimation(\"newAnimation\", 1);\r\n                this.xiaochuEffect.node.y = array[key][0].y + array[key][0].height;\r\n                Msger.emit(Msger.on_play_sound, 8);\r\n            }\r\n        }\r\n    }\r\n    private check_collision(brick: cc.Node) {\r\n        for (let item of this.bricksLayer.children) {\r\n            if (brick == item || item.getComponent(BrickSc).moveSpeed != 0) {\r\n                continue;\r\n            }\r\n            if (brick.x == item.x) {\r\n                if (brick.y >= item.y - item.height) {\r\n                    // console.log(item.height,item.y);\r\n                    brick.y = item.y - item.height;\r\n                    brick.getComponent(BrickSc).moveSpeed = 0;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    private closeOne(brick: cc.Node) {\r\n        let score = 1;\r\n        for (let i = 1; i < 9; i++) {\r\n            let getBrick = this.getOneBrickFromXY(brick.x, brick.y - brick.height * i);\r\n            if(getBrick?.getComponent(BrickSc)?.moveSpeed != 0){\r\n                continue;\r\n            }\r\n            if (getBrick) {\r\n                score += this.closeOne(getBrick);\r\n            }\r\n        }\r\n        brick.removeFromParent(true);\r\n        Msger.emit(Msger.on_clean_brick, this.closeLayer, brick.position);\r\n        return score;\r\n    }\r\n    private getOneBrickFromXY(x, y) {\r\n        for (let item of this.bricksLayer.children) {\r\n            let indexX = Math.floor(item.x / item.width);\r\n            let indexY = Math.floor(item.y / item.height);\r\n            if (indexY == Math.floor(y / item.height) && indexX == Math.floor(x / item.width)) {\r\n                return item;\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n    add_line_bricks(topBrick: cc.Node = null) {\r\n        let sum = Math.random() * 3;\r\n        sum = Math.floor(sum) + 2;\r\n        if (sum == 4) {\r\n            sum = 3;\r\n        }\r\n        let temp = [];\r\n        for (let i = 0; i < sum; i++) {\r\n            let brick = cc.instantiate(this.blockPrefab);\r\n            brick.y = topBrick == null ? this.begin_y : topBrick.y + topBrick.height;\r\n            let j = 0;\r\n            do {\r\n                j = Math.floor(Math.random() * this.points.length);\r\n            } while (temp.indexOf(j) >= 0);\r\n            temp.push(j);\r\n            brick.x = this.points[j];\r\n            this.bricksLayer.addChild(brick);\r\n        }\r\n    }\r\n    onclick_back() {\r\n        Msger.emit(Msger.on_play_sound, 1);\r\n        Msger.emit(Msger.on_changeto_start);\r\n        this.isPaused = true;\r\n    }\r\n    add_move_brick(index) {\r\n        let brick = cc.instantiate(this.blockPrefab);\r\n        brick.y = -this.begin_y + 200;\r\n        brick.x = this.points[index];\r\n        brick.getComponent(BrickSc).moveSpeed = -2000;\r\n        this.bricksLayer.addChild(brick);\r\n    }\r\n    play_hit_effect() {\r\n        this.quanjiEffect.node.active = true;\r\n        let array = this.bricksLayer.children.sort((a, b) => {\r\n            return a.y - b.y;\r\n        })\r\n        this.quanjiEffect.node.y = array[0].y + 300;\r\n        this.quanjiEffect.playAnimation(\"newAnimation\", 1);\r\n    }\r\n}\r\n"]}
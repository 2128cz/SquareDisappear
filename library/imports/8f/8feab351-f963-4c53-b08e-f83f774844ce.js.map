{"version":3,"sources":["assets\\scripts\\game\\GameLevel.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import {\r\n\tDevelopersToolGlobal as ccvv,\r\n\tmathMacro as mm\r\n} from \"../base/class/DevelopersToolGlobal\";\r\nimport GridAbsorb from \"../base/tool/GridAdsorb\";\r\nimport PawnMovement from \"../base/tool/PawnMovement\";\r\nimport { SoundPlayer } from \"../base/tool/SoundPlayer\";\r\nimport BlockGroup from \"./BlockGroup\";\r\nimport ss from \"./Setting\";\r\nconst { ccclass, property, executeInEditMode } = cc._decorator;\r\n/**\r\n * 对于关卡蓝图中的参数，都定义在设置中\r\n * 而其他蓝图中的参数则会放置在其最强关联处，比如自己本身的类内\r\n * 而部分地方可能会用到全局工具的部分，可以改为以设置类全局的模式，全局工具是旧方法\r\n * 关于全局工具的用法，可以参考discard-标记的文件，他们是已经确定废弃的用法\r\n * \r\n * 游戏的基本运行与玩家交互是在 GameLevel 中完成的\r\n * 游戏会发射方块组 BlockGroup 而不是方块，由每一行的方块完成初始化，销毁检测\r\n * 每个方块组内包含四个方块 Block ，它们会在诞生时自动消灭一部分，留空给玩家，当产生销毁时会播放音效，并切换为动画预制体\r\n * 除此之外，所有公用的参数都在 setting 中，而对于更加更加具有通用性质的 globaltool 只在部分场景使用\r\n * 你可以忽略base中的大部分文件，它们没什么用。\r\n * \r\n * 关于音乐触发，你应该去MenuLevel上看看，\r\n */\r\n@ccclass\r\nexport default // @executeInEditMode\r\nclass GameLevel extends cc.Component {\r\n\t@property(cc.Node) gameArea: cc.Node = null;\r\n\r\n\t@property(cc.Node) effectArea: cc.Node = null;\r\n\r\n\t// tag LIFE-CYCLE CALLBACKS:\r\n\r\n\tonLoad() {\r\n\t\t// 提升脚本，这是为了兼容旧方法，设置中也同提升了\r\n\t\tccvv.script = this;\r\n\r\n\t\t// 开启碰撞\r\n\t\tlet manager = cc.director.getCollisionManager();\r\n\t\tmanager.enabled = true;\r\n\t\tmanager.enabledDebugDraw = true;\r\n\t\tmanager.enabledDrawBoundingBox = true;\r\n\t}\r\n\r\n\tonEnable() {\r\n\t\t// 基本初始化, enable时游戏就已经开始了\r\n\t\tthis.init();\r\n\t}\r\n\r\n\t// start() {}\r\n\r\n\tupdate(dt) {\r\n\t\t// 如果目标位置小于一定时，创建方块\r\n\t\tlet pos = GridAbsorb.grid.getGridPositionByIndex(\r\n\t\t\tss.GridCurrentPointToVec\r\n\t\t);\r\n\t\tif (pos.y > 0 && pos.y <= cc.winSize.height / 2) {\r\n\t\t\tthis.SpawnCubeGroupAndInit(ss.GridPointer);\r\n\t\t}\r\n\t\t// 如果最后一行小于一定时，结束游戏\r\n\t\tif (ss.endCubeGroup && ss.endCubeGroup.node.y < ss.Separator) {\r\n\t\t\tthis.gameOver();\r\n\t\t} else {\r\n\t\t\t// 否则继续网格移动，这也会驱动方块移动\r\n\t\t\t// 简单的移动方式\r\n\t\t\t// GridAbsorb.grid.offset = ss.GameVector.mul(dt);\r\n\r\n\t\t\t// 根据当前分数计算新速度\r\n\t\t\tthis.setGameSpeed(0.5 / dt * ss.score);\r\n\t\t\t// 移动组件移动方式\r\n\t\t\tss.movement.addforce = ss.GameAutoSpeed;\r\n\t\t\tss.movement.addDrag = ss.GameAutoDrag;\r\n\t\t\tss.movement.maxSpeed = this.GameSpeed;\r\n\t\t\tss.movement.updateByVelocity(dt);\r\n\t\t}\r\n\t}\r\n\r\n\t// tag 用户函数部分\r\n\r\n\t/**\r\n     * 游戏重置及初始化  \r\n     * 开始时调用一次\r\n     */\r\n\tprotected init(): void {\r\n\t\t// 初始化对齐网格\r\n\t\tGridAbsorb.grid = new GridAbsorb(\r\n\t\t\tnew cc.Vec3(ss.Game_Column, ss.Game_Row2, 0),\r\n\t\t\tnew cc.Vec3(ss.Cube_width, ss.Cube_Height, 0)\r\n\t\t);\r\n\t\t// 赋予移动组件\r\n\t\tss.movement = new PawnMovement(GridAbsorb.grid);\r\n\t\tss.movement.maxSpeed = this.GameSpeed;\r\n\t\t// 设置网格边界锚点\r\n\t\t// GridAbsorb.grid.anchor = new cc.Vec3(0, 0, 0);\r\n\t\t// 设置网格起点\r\n\t\tGridAbsorb.grid.offset = ss.GridOriginOffset;\r\n\r\n\t\t// 重置网格指针\r\n\t\tss.GridCurrentPoint = 0;\r\n\r\n\t\t// 注册触摸\r\n\t\tthis.touchRegister();\r\n\r\n\t\t// 清理战场\r\n\t\tss.endCubeGroup = null;\r\n\t\tif (this.gameArea.children.length > 0)\r\n\t\t\tthis.gameArea.children.forEach(e => {\r\n\t\t\t\te.destroy();\r\n\t\t\t});\r\n\t\tif (this.effectArea.children.length > 0)\r\n\t\t\tthis.effectArea.children.forEach(e => {\r\n\t\t\t\te.destroy();\r\n\t\t\t});\r\n\t\t\r\n\t\tthis.lastGroup = null;\r\n\r\n\t\t// 复位游戏标记\r\n\t\tthis.gameOverSign = false;\r\n\t}\r\n\r\n\t/**\r\n     * 创建方块组，并按链初始化  \r\n     */\r\n\tprotected SpawnCubeGroupAndInit(index): cc.Node {\r\n\t\t// 初始化,将上一个组传给这组\r\n\t\tlet inst = this.SpawnCubeGroup();\r\n\t\t// 提供索引以便吸附到网格上\r\n\t\tlet instComponent: BlockGroup = inst.getComponent(ss.blockGroupName);\r\n\t\t// 初始化,将索引给到这\r\n\t\tinstComponent.init(index, this.lastGroup);\r\n\t\t// 现在这组是上组了\r\n\t\tthis.lastGroup = instComponent;\r\n\t\treturn inst;\r\n\t}\r\n\t/**\r\n     * 创建方块组 \r\n     * @param index \r\n     */\r\n\tpublic SpawnCubeGroup(): cc.Node {\r\n\t\tlet inst = this.creatActor(ss.SquareGroup, this.gameArea);\r\n\t\treturn inst;\r\n\t}\r\n\t/**\r\n     * 创建方块\r\n     */\r\n\tprotected SpawnPlayerCube(): cc.Node {\r\n\t\tlet inst = this.creatActor(ss.Square, this.gameArea);\r\n\t\t// 提供索引以便吸附到网格上\r\n\t\tinst.getComponent(\"Block\").init();\r\n\t\treturn inst;\r\n\t}\r\n\r\n\t/**\r\n    * 游戏结束时的动作  \r\n    * 游戏结束时调用一次\r\n    */\r\n\tprotected gameOver() {\r\n\t\tif (!this.gameOverSign) {\r\n\t\t\tthis.gameOverSign = true;\r\n\r\n\t\t\t// 暂停触摸\r\n\t\t\t// ccvv.layers[0].pauseSystemEvents(true);\r\n\t\t\tss.menu.gameOver();\r\n\r\n\t\t\t// 记录分数，但不要处理\r\n\t\t\tss.highScore = ss.score;\r\n\r\n\t\t\tlet allChildren = this.lastGroup.findAllChildren(this.lastGroup);\r\n\t\t\t// 一个一个破掉的效果\r\n\t\t\tlet allChildrenCount = allChildren.length;\r\n\t\t\tthis.schedule(() => {\r\n\t\t\t\tif (allChildrenCount--) {\r\n\t\t\t\t\tlet desAct = allChildren[allChildrenCount];\r\n\t\t\t\t\tdesAct.getComponent(ss.blockName).destroyWithAnimation();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.unscheduleAllCallbacks();\r\n\t\t\t\t\tss.menu.openMenu();\r\n\t\t\t\t}\r\n\t\t\t}, 0.08);\r\n\r\n\t\t}\r\n\t}\r\n\t/**\r\n     * 游戏结束标记，避免重复调用结束事件\r\n     * 不可以在其他任何地方调用，以免逻辑混乱\r\n     */\r\n\tprivate _GameOverSign: boolean = false;\r\n\tprotected set gameOverSign(value: boolean) {\r\n\t\tthis._GameOverSign = value;\r\n\t}\r\n\tpublic get gameOverSign(): boolean {\r\n\t\treturn this._GameOverSign;\r\n\t}\r\n\r\n\t// tag 用户触摸事件\r\n\r\n\t/**\r\n     * 注册触摸事件\r\n     */\r\n\tprotected touchRegister() {\r\n\t\tif (!this.readyTouch) {\r\n\t\t\tthis.readyTouch = true;\r\n\t\t\tccvv.layers[0].on(\"touchstart\", this.onTouchStart, this);\r\n\t\t} else {\r\n\t\t\tccvv.layers[0].resumeSystemEvents(true);\r\n\t\t}\r\n\t}\r\n\tprotected readyTouch: boolean = false;\r\n\tpublic onTouchStart(event) {\r\n\t\tlet touchArea = event.getLocation().x / ss.Cube_width;\r\n\t\tlet inst = this.SpawnPlayerCube();\r\n\t\tlet inx =\r\n\t\t\tMath.ceil(touchArea) * (ss.Cube_width + ss.Cube_Interaval) -\r\n\t\t\t(cc.winSize.width + ss.Cube_width) / 2;\r\n\t\t// let inx = Math.ceil(touchArea) * 177 - ((cc.winSize.width + ss.Cube_width) / 2) - 5\r\n\t\tinst.setPosition(inx, ss.Separator);\r\n\t\t// todo 播放音效\r\n\t\tnew SoundPlayer(ss.Sound_shot);\r\n\t}\r\n\r\n\t// tag 特效方法\r\n\r\n\t/**\r\n     * 冰冻特效  \r\n     * 赋予两倍阻力\r\n     */\r\n\tice(): void {\r\n\t\t// todo 播放音效\r\n\t\tnew SoundPlayer(ss.Sound_ice);\r\n\r\n\t\tlet inst = this.creatActor(ss.Effect_Ice, this.effectArea);\r\n\t\tss.movement.permDrag = 2;\r\n\t\tthis.scheduleOnce(() => {\r\n\t\t\tss.movement.permDrag = 0;\r\n\t\t}, ss.ice_Duration);\r\n\t}\r\n\t/**\r\n     * 击退特效  \r\n     * 赋予一个反方向的力  \r\n     */\r\n\thit(): void {\r\n\t\t// todo 播放音效\r\n\t\tnew SoundPlayer(ss.Sound_hit);\r\n\r\n\t\tthis.setGameSpeed(0);\r\n\r\n\t\tlet inst = this.creatActor(ss.Effect_Hit, this.effectArea);\r\n\t\tinst.setPosition(ss.endCubeGroup.node.getPosition());\r\n\t\tss.movement.addforce = new cc.Vec2(0, ss.hit_Force);\r\n\t\tss.movement.drag = 0;\r\n\t\tss.movement.maxSpeed = this.GameSpeed;\r\n\t}\r\n\t/**\r\n     * 清屏特效  \r\n     * 将屏幕内的所有方块都进行清理，使用的是方块自身的消除方法，所以也会播放销毁特效\r\n     */\r\n\tboom(): void {\r\n\t\t// todo 播放音效\r\n\t\tnew SoundPlayer(ss.Sound_boom);\r\n\r\n\t\tthis.setGameSpeed(0);\r\n\r\n\t\tlet inst = this.creatActor(ss.Effect_Boom, this.effectArea);\r\n\t\tss.endCubeGroup = this.lastGroup.nextGroup;\r\n\t\tthis.lastGroup.destroyMembers(false);\r\n\t}\r\n\r\n\t// tag 基本操作函数\r\n\r\n\t/**\r\n    * creat instantiate\r\n    * @param {cc.Prefab} actor 实例化的目标\r\n    * @param {cc.Node} parent 实例化的对象将要附加的目标，如果留空则为自身\r\n    * @returns \r\n    */\r\n\tprotected creatActor(actor: cc.Prefab, parent?: cc.Node): cc.Node {\r\n\t\tlet actorInst = cc.instantiate(actor);\r\n\t\tif (parent) {\r\n\t\t\tparent.addChild(actorInst);\r\n\t\t} else {\r\n\t\t\tthis.node.addChild(actorInst);\r\n\t\t\tcc.log(actorInst);\r\n\t\t}\r\n\t\treturn actorInst;\r\n\t}\r\n\t/**\r\n     * 上一组诞生组\r\n     */\r\n\tprotected lastGroup: BlockGroup = null;\r\n\t/**\r\n     * 上叠运行速度\r\n     */\r\n\tprotected _MultiplyGameSpeed: number = 0;\r\n\t/**\r\n     * 上叠运行速度\r\n     */\r\n\tprotected get GameSpeed(): number {\r\n\t\treturn ss.GameSpeed + this._MultiplyGameSpeed;\r\n\t}\r\n\t/**\r\n     * 添加上叠运行速度\r\n     */\r\n\tprotected set GameSpeed(value: number) {\r\n\t\tthis._MultiplyGameSpeed = Math.max(\r\n\t\t\tMath.min(this._MultiplyGameSpeed + value, ss.GameSpeed_MulMax),\r\n\t\t\t0\r\n\t\t);\r\n\t}\r\n\t/**\r\n     * 直接设置上叠运行速度\r\n     */\r\n\tprotected setGameSpeed(value: number) {\r\n\t\tthis._MultiplyGameSpeed = value;\r\n\t}\r\n}\r\n"]}
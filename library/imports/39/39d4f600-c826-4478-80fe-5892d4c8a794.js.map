<<<<<<< HEAD
{"version":3,"sources":["assets\\load\\Loading.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// SIGNPOST 加载页面，但不属于开发类\r\nconst { ccclass, property } = cc._decorator;\r\n\r\ncc['vv'] = cc['vv'] || {};\r\n\r\n// 让编译器忽略平台API报错\r\ndeclare var wx: any;\r\n\r\n@ccclass\r\nexport default class Loading extends cc.Component {\r\n\r\n    @property(cc.Node)\r\n    logoNode: cc.Node = null;\r\n\r\n    @property({\r\n        type: cc.Node,\r\n        displayName: \"进度条目标(可选)\",\r\n        tooltip: \"进度条目标设定后可以指定动画\",\r\n    })\r\n    progressBar: cc.Node = null;\r\n\r\n    // SIGNPOST 进度条部分\r\n    @property({\r\n        type: cc.Float,\r\n        range: [0, 2, 0.01],\r\n        slide: true,\r\n        displayName: \"进度条动画速率\",\r\n        visible() { return this.progressBar != null; },\r\n    })\r\n    progressUpdateRate = 1;\r\n\r\n    @property({\r\n        type: cc.Float,\r\n        range: [0, 2, 0.01],\r\n        slide: true,\r\n        displayName: \"进度条动画随机变化间隔\",\r\n        tooltip: \"进度条动画随机变化间隔\",\r\n        visible() { return this.progressBar != null; },\r\n    })\r\n    progressRandomChangeTime = .2;\r\n\r\n    @property({\r\n        type: cc.Float,\r\n        range: [0, 2, 0.01],\r\n        slide: true,\r\n        displayName: \"进度条动画等待加载完成位置\",\r\n        tooltip: \"进度条动画等待加载完成位置\",\r\n        visible() { return this.progressBar != null; },\r\n    })\r\n    progressWaitForLoad = .85;\r\n\r\n    @property({\r\n        type: cc.Node,\r\n        displayName: \"完成后显示\",\r\n        tooltip: \"当加载完成时，被启用的节点\",\r\n        visible() { return this.progressBar != null; },\r\n    })\r\n    readyToShow = null;\r\n\r\n    // SIGNPOST 目标场景部分\r\n    @property({\r\n        type: cc.SceneAsset,\r\n        displayName: \"完成后加载目标\",\r\n        tooltip: \"当加载完成时，加载的场景，如果有启用节点，则等待节点触发\",\r\n    })\r\n    readyToGoSence = null;\r\n\r\n    // TAG LIFE-CYCLE callbacks                                                                              \r\n\r\n    onLoad() {\r\n        // 播放动画\r\n        this.playLogoAnimation();\r\n        //检查游戏更新\r\n        this.checkGameNewVersion();\r\n    }\r\n\r\n    start() {\r\n        // 开始加载所有资源\r\n        this.loadAllResources();\r\n    }\r\n\r\n    update(dt) {\r\n        // 如果有定义其他组件（比如按钮）来完成场景载入触发时，等待组件响应\r\n        if (this.readyToShow != null) return;\r\n        // 否则加载完成后直接进入场景\r\n        if (this.loadProgressCount >= this.loadPorgressCountMax) {\r\n            this.onLoadScene();\r\n        }\r\n    }\r\n\r\n    // TAG 自定义数值                                                                                         \r\n\r\n    /**\r\n     * 加载资源目录\r\n     */\r\n    loadResourcescatalog = {\r\n        // \"url\": { type: res type, url: \"save url\" },\r\n        //加载音乐音效资源\r\n        \"sounds\": { type: cc.AudioClip, url: \"sounds\" },\r\n        //加载预制件资源\r\n        \"prefabs\": { type: cc.Prefab, url: \"prefabs\" },\r\n        //加载图集资源\r\n        // \"atlas\": { type: cc.SpriteAtlas, url: \"atlas\" },\r\n        //加载单个精灵资源\r\n        \"frames\": { type: cc.SpriteFrame, url: \"frames\" },\r\n    }\r\n\r\n    /**\r\n     * 进度条数值\r\n     * 数值应该在0-100\r\n     */\r\n    ProgressValue: number = 0;\r\n\r\n    /**\r\n     * 加载进度，以资源载入完成+1\r\n     * 当载入计数等于资源数时，完成加载\r\n     */\r\n    loadProgressCount: number = 0;\r\n    loadPorgressCountMax: number = Object.keys(this.loadResourcescatalog).length;\r\n\r\n    // TAG USER FUNCTION:                                                                                    \r\n\r\n    // tag 用户方法 \r\n\r\n    /**\r\n     * 播放开始动画\r\n     */\r\n    private playLogoAnimation(): void {\r\n        cc.tween(this.logoNode)\r\n            .delay(0.5)\r\n            .to(1, { opacity: 255 })\r\n            .delay(1)\r\n            .call(() => { })\r\n            .start()\r\n    }\r\n\r\n    /**\r\n     * 如果此场景内有其他按钮等组件触发时\r\n     * 可以通过这里进行中转\r\n     * 要求格式为 on + todo\r\n     */\r\n    public onButtonClick(event, customDate): void {\r\n        if (customDate.indexOf(\"on\") <= 0)\r\n            this[customDate]();\r\n        else\r\n            this.onLoadScene()\r\n    }\r\n\r\n    /**\r\n     * 加载场景\r\n     * @param sceneTarget 可选场景目标\r\n     */\r\n    private onLoadScene(sceneTarget?: string | cc.SceneAsset): void {\r\n        cc.director.loadScene((() => {\r\n            return sceneTarget ?\r\n                sceneTarget instanceof String ?\r\n                    sceneTarget :\r\n                    (sceneTarget as cc.SceneAsset).name :\r\n                this.readyToGoSence.name;\r\n        })());\r\n    }\r\n\r\n    // tag 客户端方法 \r\n\r\n    /**\r\n     * 加载全部资源包\r\n     */\r\n    private loadAllResources(): void {\r\n        cc['vv']['warehouse'] = cc['vv']['warehouse'] || {};\r\n\r\n        let resKeys = Object.keys(this.loadResourcescatalog);\r\n        resKeys.forEach(url => {\r\n            let resLog = this.loadResourcescatalog[url];\r\n            cc['vv']['warehouse'][resLog.url] = cc['vv']['warehouse'][resLog.url] || {};\r\n            this.loadResources(url, resLog.type, resLog.url);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 按类加载资源包\r\n     * @param url \r\n     * @param type \r\n     * @param saveUrl \r\n     */\r\n    private loadResources(url, type, saveUrl): void {\r\n        let self = this;\r\n        cc.resources.loadDir(url, type,\r\n\r\n            (completedCount, totalCount, item) => {\r\n                // cc.log(\"正在加载:\" + item.url);\r\n                self.ProgressValue = completedCount / totalCount;\r\n                // cc.log(`加载进度: ${self.ProgressValue * 100}%`);\r\n            },\r\n\r\n            (err, data) => {\r\n                if (err) {\r\n                    cc.log(`加载${type}时发生错误`);\r\n                } else {\r\n                    for (let i in data) {\r\n                        let name = (data[i] instanceof cc.SpriteAtlas) ? data[i].name.slice(0, -6) : data[i].name;\r\n                        if (data[i] instanceof cc.JsonAsset) {\r\n                            cc['vv']['warehouse'][saveUrl][name] = data[i]['json'];\r\n                        } else {\r\n                            cc['vv']['warehouse'][saveUrl][name] = data[i];\r\n                        }\r\n                    }\r\n                }\r\n                self.loadProgressCount++;\r\n            })\r\n    }\r\n\r\n    // tag 微信平台更新 \r\n\r\n    /**\r\n     * 检查游戏新版本\r\n     */\r\n    private checkGameNewVersion(): boolean {\r\n        // 仅关注微信平台\r\n        if (!(cc.sys.platform == cc.sys.WECHAT_GAME)) return false;\r\n        // 尝试获取微信更新管理器\r\n        let updateManager: any;\r\n        try {\r\n            updateManager = wx.getUpdateManager();\r\n            if (!updateManager) return false;\r\n        }\r\n        catch { return false; }\r\n\r\n        // 获取全局唯一的版本更新管理器，用于管理小程序更新\r\n        updateManager.onCheckForUpdate(function (res) {\r\n            // 监听向微信后台请求检查更新结果事件 \r\n            console.log(\"是否有新版本：\" + res.hasUpdate);\r\n            if (res.hasUpdate) {\r\n                //如果有新版本                \r\n                // 小程序有新版本，会主动触发下载操作        \r\n                updateManager.onUpdateReady(function () {\r\n                    //当新版本下载完成，会进行回调          \r\n                    wx.showModal({\r\n                        title: '更新提示',\r\n                        content: '新版本已经准备好，单击确定重启小程序',\r\n                        showCancel: false,\r\n                        success: function (res) {\r\n                            if (res.confirm) {\r\n                                // 新的版本已经下载好，调用 applyUpdate 应用新版本并重启小程序               \r\n                                updateManager.applyUpdate();\r\n                            }\r\n                        }\r\n                    })\r\n                })\r\n                // 小程序有新版本，会主动触发下载操作（无需开发者触发）        \r\n                updateManager.onUpdateFailed(function () {\r\n                    //当新版本下载失败，会进行回调          \r\n                    wx.showModal({\r\n                        title: '提示',\r\n                        content: '检查到有新版本，但下载失败，请稍后尝试',\r\n                        showCancel: false,\r\n                    })\r\n                })\r\n            }\r\n        });\r\n        return true;\r\n    }\r\n\r\n    //微信分包\r\n    private wxSubpackage(): void {\r\n        let self = this;\r\n        wx.loadSubpackage({\r\n            name: 'resources', // name 可以填 name 或者 root\r\n            success: function (res) {\r\n                // 分包加载成功后通过 success 回调\r\n                self.loadAllResources();\r\n            },\r\n            fail: function (err) {\r\n                // 分包加载失败通过 fail 回调\r\n                console.error(`load ${name} fail`, err);\r\n            }\r\n        })\r\n\r\n    }\r\n\r\n\r\n\r\n}\r\n"]}
=======
{"version":3,"sources":["assets\\load\\Loading.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// SIGNPOST 加载页面，但不属于开发类\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n// 让编译器忽略平台API报错\r\ndeclare var wx: any;\r\n@ccclass\r\nexport default class Loading extends cc.Component {\r\n\r\n    @property(cc.Node)\r\n    logoNode: cc.Node = null;\r\n\r\n    @property({\r\n        type: cc.Node,\r\n        displayName: \"进度条目标\",\r\n        tooltip: \"进度条目标设定后可以指定动画\",\r\n    })\r\n    progressBar: cc.Node = null;\r\n\r\n    // SIGNPOST 进度条部分\r\n    @property({\r\n        type: cc.Float,\r\n        range: [0, 2, 0.01],\r\n        slide: true,\r\n        displayName: \"进度条动画速率\",\r\n        visible() {\r\n            return this.progressBar != null;\r\n        },\r\n    })\r\n    progressUpdateRate = 1;\r\n\r\n    @property({\r\n        type: cc.Float,\r\n        range: [0, 2, 0.01],\r\n        slide: true,\r\n        displayName: \"进度条动画随机变化间隔\",\r\n        tooltip: \"进度条动画随机变化间隔\",\r\n        visible() {\r\n            return this.progressBar != null;\r\n        },\r\n    })\r\n    progressRandomChangeTime = .2;\r\n\r\n    @property({\r\n        type: cc.Float,\r\n        range: [0, 2, 0.01],\r\n        slide: true,\r\n        displayName: \"进度条动画等待加载完成位置\",\r\n        tooltip: \"进度条动画等待加载完成位置\",\r\n        visible() {\r\n            return this.progressBar != null;\r\n        },\r\n    })\r\n    progressWaitForLoad = .85;\r\n\r\n    @property({\r\n        type: cc.Node,\r\n        displayName: \"完成后显示\",\r\n        tooltip: \"当加载完成时，被启用的节点\",\r\n        visible() {\r\n            return this.progressBar != null;\r\n        },\r\n    })\r\n    readyToShow = null;\r\n\r\n    @property({\r\n        type: cc.SceneAsset,\r\n        displayName: \"完成后加载目标\",\r\n        tooltip: \"当加载完成时，加载的场景，如果有启用节点，则等待节点触发\",\r\n        visible() {\r\n            return this.progressBar != null;\r\n        },\r\n    })\r\n    readyToGoSence = null;\r\n\r\n    // TAG LIFE-CYCLE callbacks                                                                              \r\n\r\n    onLoad() {\r\n        // 播放动画\r\n        this.playLogoAnimation();\r\n        //检查游戏更新\r\n        this.checkGameNewVersion();\r\n        // 资源加载初始化\r\n        this.ProgressValue = 0;\r\n    }\r\n\r\n    start() {\r\n\r\n    }\r\n\r\n    update(dt) {\r\n\r\n    }\r\n\r\n    // TAG 自定义数值                                                                                         \r\n\r\n    /**\r\n     * 进度条数值\r\n     * 数值应该在0-100\r\n     */\r\n    ProgressValue: number = 0;\r\n    /**\r\n     * 加载资源目录\r\n     */\r\n    loadResourcescatalog = {\r\n        // \"url\": { type: res type, url: \"save url\" },\r\n        //加载音乐音效资源\r\n        \"sounds\": { type: cc.AudioClip, url: \"sounds\" },\r\n        //加载预制件资源\r\n        \"prefabs\": { type: cc.Prefab, url: \"prefabs\" },\r\n        //加载图集资源\r\n        \"atlas\": { type: cc.SpriteAtlas, url: \"atlas\" },\r\n        //加载单个精灵资源\r\n        \"frames\": { type: cc.SpriteFrame, url: \"frames\" },\r\n    }\r\n\r\n    // TAG USER FUNCTION:                                                                                    \r\n\r\n    // tag 用户方法 \r\n\r\n    /**\r\n     * 播放开始动画\r\n     */\r\n    private playLogoAnimation() {\r\n        cc.tween(this.logoNode)\r\n            .delay(0.5)\r\n            .to(1, { opacity: 255 })\r\n            .delay(1)\r\n            .call(() => {\r\n                cc.director.loadScene(\"Game\");\r\n            })\r\n            .start()\r\n    }\r\n\r\n    // tag 客户端方法 \r\n\r\n    /**\r\n     * 加载全部资源包\r\n     */\r\n    private loadAllResources() {\r\n        let resKeys = Object.keys(this.loadResourcescatalog);\r\n        resKeys.forEach(url => {\r\n            this.loadResources(url, this.loadResourcescatalog['type'], this.loadResourcescatalog['url']);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 按类加载资源包\r\n     * @param url \r\n     * @param type \r\n     * @param saveUrl \r\n     */\r\n    private loadResources(url, type, saveUrl) {\r\n        let self = this;\r\n        cc.resources.loadDir(url, type,\r\n\r\n            (completedCount, totalCount, item) => {\r\n                cc.log(\"正在加载:\" + item.url);\r\n                self.ProgressValue = completedCount / totalCount;\r\n                cc.log(`加载进度: ${self.ProgressValue * 100}%`);\r\n            },\r\n\r\n            (err, data) => {\r\n                if (err) {\r\n                    cc.log(`加载${type}时发生错误`);\r\n                } else {\r\n                    for (let i in data) {\r\n                        let name = (data[i] instanceof cc.SpriteAtlas) ? data[i].name.slice(0, -6) : data[i].name;\r\n                        if (data[i] instanceof cc.JsonAsset) {\r\n                            cc['vv'].warehouse[saveUrl][name] = data[i]['json'];\r\n                        } else {\r\n                            cc['vv'].warehouse[saveUrl][name] = data[i];\r\n                        }\r\n                    }\r\n                }\r\n            })\r\n    }\r\n\r\n    /**\r\n     * 检查游戏新版本\r\n     */\r\n    private checkGameNewVersion() {\r\n        // 仅关注微信平台\r\n        if (!(cc.sys.platform == cc.sys.WECHAT_GAME)) return;\r\n        // 尝试获取微信更新管理器\r\n        let updateManager: any;\r\n        try {\r\n            updateManager = wx.getUpdateManager();\r\n            if (!updateManager) return;\r\n        }\r\n        catch { return; }\r\n\r\n        // 获取全局唯一的版本更新管理器，用于管理小程序更新\r\n        updateManager.onCheckForUpdate(function (res) {\r\n            // 监听向微信后台请求检查更新结果事件 \r\n            console.log(\"是否有新版本：\" + res.hasUpdate);\r\n            if (res.hasUpdate) {\r\n                //如果有新版本                \r\n                // 小程序有新版本，会主动触发下载操作        \r\n                updateManager.onUpdateReady(function () {\r\n                    //当新版本下载完成，会进行回调          \r\n                    wx.showModal({\r\n                        title: '更新提示',\r\n                        content: '新版本已经准备好，单击确定重启小程序',\r\n                        showCancel: false,\r\n                        success: function (res) {\r\n                            if (res.confirm) {\r\n                                // 新的版本已经下载好，调用 applyUpdate 应用新版本并重启小程序               \r\n                                updateManager.applyUpdate();\r\n                            }\r\n                        }\r\n                    })\r\n                })\r\n                // 小程序有新版本，会主动触发下载操作（无需开发者触发）        \r\n                updateManager.onUpdateFailed(function () {\r\n                    //当新版本下载失败，会进行回调          \r\n                    wx.showModal({\r\n                        title: '提示',\r\n                        content: '检查到有新版本，但下载失败，请稍后尝试',\r\n                        showCancel: false,\r\n                    })\r\n                })\r\n            }\r\n        });\r\n\r\n    }\r\n\r\n    //微信分包\r\n    wxSubpackage() {\r\n        let self = this;\r\n        wx.loadSubpackage({\r\n            name: 'resources', // name 可以填 name 或者 root\r\n            success: function (res) {\r\n                // 分包加载成功后通过 success 回调\r\n                self.loadAllResources();\r\n            },\r\n            fail: function (err) {\r\n                // 分包加载失败通过 fail 回调\r\n                console.error(`load ${name} fail`, err);\r\n            }\r\n        })\r\n\r\n    }\r\n\r\n\r\n\r\n}\r\n"]}
>>>>>>> db2b8a7ddf217d18bb4f5789a18927dfb7aaa562
